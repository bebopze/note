### 1. 通信协议综述

###### 1.1 为什么要学习网络协议？

```
    
    ⼩结：
    
        ⼀个简简单单的下单过程，中间牵扯到这么多的协议。
        
        ⽽管理⼀⼤⽚机器，更是⼀件特别有技术含量的事情。
        
        除此之外，像最近⽐较⽕的云计算、容器、微服务等技术，也都需要借助各种协议，来达成⼤规模机器之间的合作。
    
    
    
    QA：
        
        1. mac地址是唯一的，为什么可以修改?
        
            想想身份证，身份证号是唯一的，不能改变的，但是可以造价。
            
            mac地址全球唯一，它是固化在网卡里的。
            
            网卡毕竟是个硬件，需要软件支持，既操作系统识别。
            
            重点来了，操作系统识别出来的mac地址是可以更改的，它只不过是一个字符串。
            
            我们常说的修改mac指的是修改电脑中记录的既注册表中的记录。
            
            
        2. 有了mac地址为什么还要有ip地址？
        
            举个例子，身份证号是你的唯一标识，不会重复，一落户就有（网卡一出厂就有mac）。
            
            现在我要和你通信（写信给你），地址用你的姓名+身份证，信能送到你手上吗?
            
            明显不能！身份证号前六位能定位你出生的县。
            
            mac地址前几位也可以定位生产厂家。
            
            但是你出生后会离开这个县（哪怕在这个县，也不能具体找到你）。
            
            所以一般写个人信息就要有出生地和现居地址了。

```



### 1.通信协议综述

###### 1.1 为什么要学习网络协议？

```
    
    ⼩结：
    
        ⼀个简简单单的下单过程，中间牵扯到这么多的协议。
        
        ⽽管理⼀⼤⽚机器，更是⼀件特别有技术含量的事情。
        
        除此之外，像最近⽐较⽕的云计算、容器、微服务等技术，也都需要借助各种协议，来达成⼤规模机器之间的合作。
    
    
    
    QA：
        
        1. mac地址是唯一的，为什么可以修改?
        
            想想身份证，身份证号是唯一的，不能改变的，但是可以造假。
            
            mac地址全球唯一，它是固化在网卡里的。
            
            网卡毕竟是个硬件，需要软件支持，既操作系统识别。
            
            重点来了，操作系统识别出来的mac地址是可以更改的，它只不过是一个字符串。
            
            我们常说的修改mac指的是修改电脑中记录的既注册表中的记录。
            
            
        2. 有了mac地址为什么还要有ip地址？
        
            举个例子，身份证号是你的唯一标识，不会重复，一落户就有（网卡一出厂就有mac）。
            
            现在我要和你通信（写信给你），地址用你的姓名+身份证，信能送到你手上吗?
            
            明显不能！身份证号前六位能定位你出生的县。
            
            mac地址前几位也可以定位生产厂家。
            
            但是你出生后会离开这个县（哪怕在这个县，也不能具体找到你）。
            
            所以一般写个人信息就要有出生地和现居地址了。
        
        
        3. 有既不走UDP又不走TCP的应用层协议吗？
        
            有的，传输层大部分情况下是tcp和udp，但是也有其他的协议比如sctp。
            
        
        
        4. 除了网络分层基础之外，我想这个问题的主要原因是: 
        
            并不是每一个设备都有一个“物理”或“外网” IP，我们的目标 IP 可能是一个局域网。
        
            ( 想想家里面每一台设备都间接的通过连接路由器上网，但是我们所有设备的外网出口 IP 都是同一个) 
            
            当我们的数据包达到目标 IP 后，通过 Mac 地址送达到具体“局域网”的某台具体物理设备上。是这样吗？
            
            
            A:
                你的包出去的时候，会在外网网关nat一下，把私网地址改为公网地址
            
                到达局域网的时候，是通过mac的，回来的时候，在你的那个网关再nat回来    
                
                
        5、Mac 和 IP
        
            mac是姓名，IP是住址，这样就可以准确的找到你了
            
            Mac是identify; IP是locate
            
            
            感觉Mac地址是手机号码，IP地址是省市区加街道详情
            点外卖的话，只有手机号码是找不到订餐人的
            只有按照省市区加街道详情，找到对应办公室
            大吼一声：“尾号XXXX是哪位？您的外卖到了！！！”
            订餐人：“这儿呐~我哒~~~”
            
             
            
            
               
```


###### 1.2  网络分层的真实含义是什么？

```
    
    ⼩结：
    
        理解⽹络协议的⼯作模式，有两个⼩窍⻔：
        
            始终想象⾃⼰是⼀个处理⽹络包的程序：
            
                如何拿到⽹络包，如何根据规则进⾏处理，如何发出去；
        
            始终牢记⼀个原则：
            
                只要是在⽹络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。
    
    
    
    QA：
        
        1. 计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决，计算机整个体系从上到下都是按照严格的层次结构设计的。
        
        
        
        2. 感觉说ip地址会变，mac不变的，都没有好好看文章
        
            包在到达目的地之前是不知道目标mac地址的，包到达目的地之后也是大吼一声谁是ip XXX，
            
            那么mac地址不变有毛用？？目前的理解应该是，封装对下层的变化
        
        
        3. 我觉得对于 网络为何要分层？这个问题的解释有点过于牵强
        
            虽说复杂的程序都要分层这点没错，但我觉得这只是它的表现，网络每一层协议负责的工作都是不一样的，也就对应了有不同设备来处理。
            
            比如应用层，一般是由计算机来处理，用于用户可使用的实际程序上；
            
            网络层，是网关之间的通讯协议，一般是路由器作处理转发。
            
            倘若说整个网络只有一层，网络上所有节点都处于同一层级，
            
            必然会造成混乱，所以最主要原因：还是要明确职责。
            
            这是架构和设计模式的问题
            
            
        4. 问为什么要分层？
        
            就好比问，写程序为什么要写函数一样。
            
            要传递的信息是由许多01组合抽象而来的，这样复杂的一堆01被抽象的分层处理，就好比要创建不同函数，
            
            每一个函数都是高内聚低耦合的，只专注于自己本层工作；
            
            每个函数的功能单一，但把多个函数组合使用，就能实现强大的功能，
            
            这样就把一个复杂的问题简单化了。
        
        
        5. 为什么会有应用层，传输层，网络层（或称为3层），链路层（或称为2层）？
        
            链路层下边还有一层，所以叫2层，它的主要目的是处理本网络内链路相关工作，所以叫链路层；
            
            网络层处于从下往上的第3层，它主要处理不同网络之间通信的工作，它会跨网通信，所以叫网络层；
            
            传输层，它是把从网络层提取出的信息按不同端口分配给不同应用程序，所以叫传输层，
            
            可以说凡是到达传输层的数据都是和本机ip地址相关的数据
            
            
        6. IP是三层协议，必须封装在二层协议（比如以太网协议）中，然后二层协议再通过硬件把包发出去，所以需要MAC地址（二层地址）；
        
        
        7. IP，Internet Protocol，网络互联协议，它设计出来是为了互联不同的网络的，他的作用是在不同网络之间做寻址。
        
        
        
```



###### 1.3  ifconfig：最熟悉又陌生的命令行

```
    
    ⼩结：
    
        看起来很简单的⼀个命令，⾥⾯学问很⼤：
        
        
            IP 是地址，有定位功能；MAC	是身份证，⽆定位功能；
            
            CIDR 可以⽤来判断是不是本地⼈；
            
            IP 分 公有的IP 和 私有的IP。
    
    
    
    QA：
        
        1. IP设计时犯的错误？
        
            低估了未来网络的发展，32位地址不够用。于是有了现在IPv6（128位）
            
            分类错误：
            
                分成了5类。C类太少，B类太多。C类254个，网络都不够；D类6万多，给企业都太多。
        
        
        2. 那后来者如何弥补IP设计者犯的错误呢？
        
            CIDR，无类型域间选路。
            
            打破原来几类地址设计的做法，将32位IP地址一分二，前者网络号，后者主机号。
            
            
            如何分呢？
            
                栗子：10.100.122.2/24
                
                24 = 前24位是网络号，那么后8位就是主机号。
            
                
            那如何用？
            
                如发送行信息给 10.100.122.255
                
                所有以 10.100.122... 开头的机器都能收到。
                
                于是有了两个概念：
                
                    广播地址：10.100.122.255
                    
                    子网掩码：255.255.255.0 -> AND 得到网络号。
                    
                    
        
        3. 每一个城市都有人民广场，IP设计是如何解决的？
        
            公有IP地址和私有IP地址。
            
            搭建世界人民都可以访问的网站，需要共有IP地址
            
            搭建只有学校同学使用的网站，只要私有IP地址
            
            
            例子1: Wi-Fi
            
                192.168.0.x 是最常用的私有 IP 地址
                192.168.0 是网络号
                192.168.0.1，往往就是你这个私有网络的出口地址
                192.168.0.255 就是广播地址。一旦发送这个地址，整个 192.168.0 网络里面的所有机器都能收到。
            
            
            例子2: 16.158.165.91/22
            
        
        4. 如何理解MAC地址？
        
            如果说IP是地址，有定位功能。
            
            那Mac就是身份证，唯一识别。
        
        
        
        ## 琐碎：
        
        5. 讲了ABC，那是D类是什么？
        
            D 类是组播地址。
            
            使用这一类地址，属于某个组的机器都能收到。
            
            这有点类似在公司里面大家都加入了一个邮件组。发送邮件，加入这个组的都能收到。
            
            组播地址在后面讲述 VXLAN 协议的时候会提到。
            
            
        
        6. IP地址scope是什么意思？
        
            对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。
            
            对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。
            
            
        
        7. 那lo是什么意思？
        
            lo 全称是loopback，又称环回接口，往往会被分配到 127.0.0.1 这个地址。
            
            这个地址用于 本机通信，经过内核处理后直接返回，不会在任何网络中出现。
            
            
        
        8. < BROADCAST,MULTICAST,UP,LOWER_UP > 是干什么的？
        
            net_device flags，网络设备的状态标识。
            
            UP 表示网卡处于启动的状态；
            
            BROADCAST 表示这个网卡有广播地址，可以发送广播包；
            
            MULTICAST 表示网卡可以发送多播包；
            
            LOWER_UP 表示 L1 是启动的，也即网线插着呢。
            
            
        
        9. MTU1500 是指什么意思呢？是哪一层的概念？
        
            最大传输单元 MTU 为 1500，这是以太网的默认值。
            
            MTU 是二层 MAC 层的概念。
            
            MAC 层有 MAC 的头，以太网规定 连 MAC 头带正文合起来，不允许超过 1500 个字节。
            
            
        10. qdisc pfifo_fast 是什么意思呢？
        
            排队规则。
            
            规定数据包如何进出的。有pfifo, pfifo_fast. 
            
            

```



###### 1.4  DHCP与PXE：IP是怎么来的，又是怎么没的？

```
    
    ⼩结：
    
        DHCP 协议 主要是⽤来 给客户租⽤ IP 地址，
            
            和房产中介很像，要商谈、签约、续租，⼴播还不能“抢单”；
            
        DHCP 协议 能给客户推荐“装修队”PXE，能够安装操作系统，这个在云计算领域⼤有⽤处。
    
    
    
    QA：
    
        
        1. 正确配置IP?
        
            CIDR、子网掩码、广播地址和网关地址。
        
        
        2. 在跨网段调用中，是如何获取目标IP的mac地址的？
        
            从源IP网关获取所在网关mac,
            
            然后又替换为目标IP所在网段网关的mac,
            
            最后是目标IP的mac地址
        
        
        3. 手动配置麻烦，怎么办？
        
            DHCP！Dynamic Host Configuration Protocol！
            
            DHCP, 让你配置IP，如同自动房产中介。
        
        
        4. 如果新来的，房子是空的(没有操作系统)，怎么办？
        
            PXE， Pre-boot Execution Environment.
            
            "装修队"PXE，帮你安装操作系统。
        
        
        
        5. 20年前大学宿舍里绕了好多同轴电缆的10M以太网，上BBS用IP，玩星际争霸用IPX。那时候没有DHCP，每栋楼有个哥们负责分配IP。
        
        
        
```



