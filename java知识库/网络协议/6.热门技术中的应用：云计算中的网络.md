## 6. 热门技术中的应用：云计算中的网络


#### 6.1  云中网络：自己拿地成本高，购买公寓更灵活

```
    
    ⼩结：
    
        云计算的关键技术是虚拟化
        
            这⾥我们重点关注的是：
        
                虚拟⽹卡通过打开 TUN/TAP 字符设备的⽅式，将虚拟机内外连接起来；
        
        
        云中的⽹络重点关注四个⽅⾯：
        
            共享、隔离、互通、灵活。
        
            其中共享和互通有两种常⽤的⽅式：
            
                分别是 桥接和 NAT，隔离可以通过 VLAN 的⽅式。
    
        
    
    QA：
        
        1. 为了直观，这⼀节的内容我们以桌⾯虚拟化系统举例。
        
            在数据中⼼⾥⾯，有⼀款著名的开源软件OpenStack，这⼀节讲的⽹络连通⽅式对应 OpenStack 中的哪些模型呢？
            
            
            openstack网络模式有三种：
            
                flat 、 flat dhcp 、 vlan
                
                
                实际上对应到kvm的两种模式：
                    
                    nat 和 桥接
                
                openstack的vlan模式 = kvm的桥接模式 + vlan
                 
                
        
        2. 这⼀节的最后，我们也提到了，本节提到的⽹络配置⽅式⽐较不灵活，你知道什么更加灵活的⽅式吗？
        
            
            另外一种方式应该是虚拟机实例增加访问控制，可以是用iptables，
            
            看了阿里云的ecs实例iptables没有运行，猜测是阿里云自己实现的访问控制，支持ip和端口的访问权限配置。
            
            
            
```


#### 6.2  软件定义网络：共享基础设施的小区物业管理办法

```
    
    ⼩结：
    
        ⽤ SDN 控制整个云⾥⾯的⽹络，就像⼩区保安从总控室管理整个物业是⼀样的，将控制⾯和数据⾯进⾏了分离；
        
        ⼀种开源的虚拟交换机的实现 OpenvSwitch，它能对经过⾃⼰的包做任意修改，从⽽使得云对⽹络的控制⼗分灵活；
        
        将 OpenvSwitch 引⼊了云之后，可以使得配置简单⽽灵活，并且可以解耦物理⽹络和虚拟⽹络。
    
        
    
    QA：
        
        xx

```


#### 6.3  云中的网络安全：虽然不是土豪，也需要基本安全和保障

```
    
    ⼩结：
    
        云中的安全策略的常⽤⽅式是，使⽤ iptables 的规则
        
            请记住它的五个阶段：
                
                PREROUTING、INPUT、FORWARD、OUTPUT、POSTROUTING
            
        
        iptables 分为四种表：
            
            raw、mangle、nat、filter。
            
            其中安全策略主要在 filter 表中实现，⽽虚拟⽹络和物理⽹络地址的转换主要在 nat 表中实现。
    
        
    
    QA：
        
        1. k8s 的 kube-proxy 就是利用的 iptables 做流量转发和负载均衡的，
        
            service 利用 nat 将相应的流量转发到对应的pod中，另外iptables 有一个probability特性，
            
            可以设置probability的百分比是多少，从而实现负载均衡
        
        
        
        2. 之前讲了gslb的原理，那么本地负载均衡slb是通过netfilter进行的实现吗？
        
           负载均衡实现方法比较多，lvs, haproxy都可以
        
        
        3. 运营商做Snat是将ipv4转ipv6吗？
           
           不是的，转成互联网的公网ip
           
           
           
```


#### 6.4  云中的网络QoS：邻居疯狂下电影，我该怎么办？

```
    
    ⼩结：
    
        云中的流量控制主要通过队列进⾏的，队列分为两⼤类：
            
            ⽆类别队列规则 和 基于类别的队列规则
        
        
        在云中⽹络 Openvswitch 中，主要使⽤的是分层令牌桶规则（HTB）：
        
            将总的带宽在⼀棵树上按照配置的⽐例进⾏分配，
            
            并且在⼀个分⽀不⽤的时候，可以借给另外的分⽀，从⽽增强带宽利⽤率。
        
               
         
    QA：
        
        xx

```


#### 6.5  xx

```
    
    ⼩结：
    
        xx
    
        
    
    QA：
        
        xx

```


#### 7.x  xx

```
    
    ⼩结：
    
        xx
    
        
    
    QA：
        
        xx

```

