
## 7. 热门技术中的应用：容器技术中的网络


#### 7.1  容器网络：来去自由的日子，不买公寓去合租

```
    
    ⼩结：
    
        容器是⼀种⽐虚拟机更加轻量级的隔离⽅式：
                        
            主要通过 namespace 和 cgroup 技术进⾏资源的隔离：
        
                namespace ⽤于负责看起来隔离
                
                cgroup    ⽤于负责⽤起来隔离
        
        
        
        容器⽹络连接到物理⽹络的⽅式和虚拟机很像：
        
            通过桥接的⽅式实现⼀台物理机上的容器进⾏相互访问，
        
            如果要访问外⽹，最简单的⽅式还是通过	NAT。
    
        
    
    QA：
        
        xx

```


#### 7.2  容器网络之Flannel：每人一亩三分地

```
    
    ⼩结：
    
        基于 NAT 的容器⽹络模型在微服务架构下有两个问题：
        
            ⼀个是 IP重叠
            
            ⼀个是 端⼝冲突
            
        需要通过 Overlay ⽹络的机制保持跨节点的连通性。
        
        
        
        Flannel 是跨节点容器⽹络⽅案之⼀：
        
            它提供的 Overlay ⽅案主要有两种⽅式：
                
                ⼀种是 UDP 在⽤户态封装
        
                ⼀种是 VXLAN 在内核态封装，⽽ VXLAN 的性能更好⼀些
        
        
        
    QA：
        
        1. 如物理机A坏了，docker要迁移到C上去，物理机B内容器中的应用如何和C中的通信
        
            会重新配置
            
        
        

```


#### 7.3  容器网络之Calico：为高效说出善意的谎言

```
    
    ⼩结：
    
        Calico 推荐使⽤ 物理机 作为路由器的模式：
        
            这种模式没有虚拟化开销，性能⽐较⾼
            
        
        Calico 的主要组件包括：
            
            路由、iptables 的配置组件 Felix、路由⼴播组件 BGP Speaker，
            
            以及⼤规模场景下的 BGP Route Reflector。
        
        
        为解决跨⽹段的问题，Calico 还有⼀种 IPIP 模式：
            
            也即通过打隧道的⽅式，从隧道端点来看，将本来不是邻居的两台机器，变成相邻的机器
    
        
    
    QA：
        
        1. ipip模式中，隧道是点到点的？
        
            那么如果服务部署到两个或多个局域网，每个局域网有n台机器，那么为了保证互相跨网互通，是否需求全部点对点打隧道？
            
            是否资源损毁太大了？怎么优化？
        
            
            回复: 使用路由，汇聚到物理路由器，物理路由器之间打通
            
            
        2. 在IPIP模式下，原本的性能优势是否又回退到了overlay类似呢？
           
           回复: 是的
           
        
        
        3. 我们的k8s1.13.0集群里面用到的就是擦calico网络，当时还在纳闷k8s怎么不用flannel网络了，
        
            现在明白了，calico网络性能要比flannel高很多，采用ip-in-ip的方式进行隧道通信，安全性也提高不少。
            
            
           回复: 后来flannel也支持calico的所有模式了
        
        
        
```


