## 5. 底层网络知识详解：陌生的数据中心


#### 5.1  DNS协议：网络世界的地址簿

```
    
    ⼩结：
    
        DNS 是⽹络世界的地址簿，可以通过域名查地址：
        
            因为域名服务器是按照树状结构组织的，因⽽域名查找是使⽤递归的⽅法，并通过缓存的⽅式增强性能；
        
        
        在域名和 IP 的映射过程中，给了应⽤基于域名做负载均衡的机会：
            
            可以是简单的负载均衡，也可以根据地址和运营商做全局的负载均衡。
        
            
    
    QA：
        
        1. 全局负载均衡为什么要分地址和运营商呢？
        
            分地址和运营商主要是为了返回最优的ip，也就是离用户最近的ip，提高用户访问的速度，
            
            分运营商也是返回最快的一条路径。
        
        
        2. 全局负载均衡使用过程中，常常遇到失灵的情况，你知道具体有哪些情况吗？对应应该怎么来解决呢？
            
            gslb失灵一般是因为一个ns请求gslb的时候，看不到用户真实的ip，从而不一定是最优的，
            
            而且这个返回的结果可能给一个用户或者一万个用户，可以通过流量监测来缓解。
        
        
        
```


#### 5.2  HTTPDNS：网络世界的地址簿也会指错路

```
    
    ⼩结：
    
        传统的 DNS 有很多问题，例如解析慢、更新不及时：
        
            因为缓存、转发、NAT 问题导致客户端误会⾃⼰所在的位置和运营商，从⽽影响流量的调度。
        
        
        HTTPDNS 通过客户端 SDK 和服务端，通过 HTTP 直接调⽤解析	DNS 的⽅式：
        
            绕过了 传统DNS 的这些缺点，实现了智能的调度。
    
        
    
    QA：
        
        1. 使⽤ HTTPDNS，需要向 HTTPDNS 服务器请求解析域名，可是客户端怎么知道	HTTPDNS 服务器的地址或者域名呢？
            
            httpdns服务器的地址一般不变 
            
            可以使用dns的方式获取httpdns服务器的ip地址 
            
            也可以直接把httpdns服务器的ip地址写死在客户端中。
                    
           
           
        2. HTTPDNS 的智能调度，主要是让客户端选择最近的服务器，
        
            ⽽有另⼀种机制，使得资源分发到离客户端更近的位置，从⽽加快客户端的访问，你知道是什么技术吗？
            
            
            回复：
            
                让用户获取离用户最近的资源 
            
                一般是静态资源 
                
                这使用的是cdn技术（content distribution network，内容分发网络）
        
        
        
```


#### 5.3  CDN：你去小卖部取过快递么？

```
    
    ⼩结：
    
        CDN 和电商系统的分布式仓储系统⼀样：
        
            分为中⼼节点、区域节点、边缘节点，⽽数据缓存在离⽤户最近的位置。
        
        
        CDN 最擅⻓的是缓存静态数据：
        
            除此之外还可以缓存流媒体数据，这时候要注意使⽤防盗链。
        
            它也⽀持动态数据的缓存：
                
                ⼀种是边缘计算的⽣鲜超市模式，另⼀种是链路优化的冷链运输模式。
    
        
    
    QA：
        
        1. DNS的作用相当于客户端找到最近最合适DNS运营商，而CDN相当于DNS运营商找到最合适的服务器获取内容。
        
        
        2. 客户端发送一个HTTP请求给HTTPDNS，HTTPDNS返回含有请求内容的CDN服务器的IP地址。
            
            与基于DNS进行负载均衡相比，少了DNS先递归查询 CDN负载均衡服务器IP地址 再通过CDN负载均衡服务器获取CDN服务器IP地址 两个步骤。

        
```


#### 5.4  数据中心：我是开发商，自己拿地盖别墅

```
    
    ⼩结：
    
        数据中⼼分为三层：
        
            服务器连接到接⼊层，然后是汇聚层，再然后是核⼼层，最外⾯是边界路由器和安全设备。
        
        数据中⼼的所有链路都需要⾼可⽤性：
        
            服务器需要绑定⽹卡，交换机需要堆叠，三层设备可以通过等价路由，⼆层设备可以通过 TRILL 协议。
        
        随着云和⼤数据的发展，东⻄流量相对于南北流量越来越重要，因⽽演化为叶脊⽹络结构。
        
        
    
    QA：
        
        1. 对于数据中⼼来讲，⾼可⽤是⾮常重要的，每个设备都要考虑⾼可⽤，那跨机房的⾼可⽤，你知道应该怎么做吗？
            
            跨机房的高可用，应该就是异地灾备了。比如说数据库的dataguard和goldengate
            
            --
            
            跨机房的高可用，类似阿里服务的异地多活，服务部署在多个机房里，机房之间完全对等，一个机房出了问题，马上切换到另一个机房中。
            
            
        
        2. 前⾯说的浏览新闻、购物、下载、看视频等⾏为，都是普通⽤户通过公⽹访问数据中⼼⾥⾯的资源。
        
            那 IT 管理员应该通过什么样的⽅式访问数据中⼼呢？
            
            
            --
            运维人员先通过公网访问跳板机，然后在跳板机上以内网地址访问服务器
            
            --
            IT管理员应该首先连接VPN，然后在访问数据中心内部服务，不能直接通过公网访问。
            
                

```


#### 5.5  VPN：朝中有人好做官

```
    
    ⼩结：
    
        VPN 可以将⼀个机构的多个数据中⼼通过隧道的⽅式连接起来，让机构感觉在⼀个数据中⼼⾥⾯，就像⾃驾游通过琼州海峡⼀样；
        
        完全基于软件的 IPsec VPN 可以保证私密性、完整性、真实性、简单便宜，但是性能稍微差⼀些；
        
        MPLS-VPN 综合和 IP 转发模式和 ATM 的标签转发模式的优势，性能较好，但是需要从运营商购买。
        
                
        
    QA：
        
        1. 当前业务的⾼可⽤性和弹性伸缩很重要，所以很多机构都会在⾃建私有云之外，采购公有云，你知道私有云和公有云应该如何打通吗？
            
            
            公有云和私有云之间打通主要通过两种方式:
            
                一种是专线，这个需要跟运营商购买，而且需要花时间搭建。
            
                一种是VPN, VPN包括今天说的 IPSec VPN 和 MPLS VPN：
            
                    这个还需要在公有云厂商那边购买VPN网关，将其和私有云的网关联通
            
            
            --
            
            通过路由端口映射，或者vpn
        
        
        2. 前⾯所有的上⽹⾏为，都是基于电脑的，但是移动互联⽹越来越成为核⼼，你知道⼿机上⽹都需要哪些协议吗？
        
            移动端上网需要gprs协议层
            
        

```


#### 5.6  移动网络：去巴塞罗那，手机也上不了脸书

```
    
    ⼩结：
    
        移动⽹络的发展历程从 2G 到 3G，再到 4G，逐渐从打电话的功能为主，向上⽹的功能为主转变；
        
        请记住 4G ⽹络的结构，有 eNodeB、MME、SGW、PGW 等，分控制⾯协议和数据⾯协议，你可以对照着结构，试着说出⼿机上⽹的流程；
        
        即便你在国外的运营商下上⽹，也是要通过国内运营商控制的，因⽽也上不了脸书。
    
        
    
    QA：
        
        1. 曾经做了十年通讯，看了很亲切，感慨作者的渊博知识和感谢作者的用心做事。
        
            题外话，通讯活又脏又累，建设好通讯高速公路真不容易，到头来被OTT了。（OTT是指互联网公司越过运营商,发展基于开放互联网的各种视频及数据服务业务）
            
            现在的通讯人就像工地民工，干的苦拿的少，互联网人就像装修公司，光鲜亮丽财大气粗！

        
        
        2. 最近几章确实比较难懂，主要原因是包含了很多平时没接触过的知识，而且每个知识都是可以拿出来单独讲上几章的，所以给大家几个建议，不对的欢迎指出探讨。
        
            1.非网络开发或运维人员的可以了解大概原理即可，不必深究细节。
            
            2.其实每一层的各种协议都有互通之处，可以先吃透ip、tcp、udp等基础常见也是作者讲解比较详细的协议，举一反三进行学习。
            
            3.想详细深入学习的建议也别指着这篇文章完全学会这么大一个知识框架，可以看看书和多找点其他文章印证着看，毕竟刚才说了，一篇文章写不完那么多东西
            
            
        3. 按照课程原理，买一张国外的手机sim卡，就可以在国内上脸书了。
        
           回复: 是的，只要国内允许接入
           
           
        4. 手机通信中的 XG 网络一般理解就是 第X代通信网络 的意思，其中的 G 不是带宽单位的意思。
           
           是的，是代的意思   
```



